\documentclass[11pt]{article}

\pdfobjcompresslevel=3    % compress PDF objects
\pdfcompresslevel=9       % compress streams more (0..9)
\pdfminorversion=4


\usepackage[utf8]{inputenc} % remove if using XeLaTeX or LuaLaTeX
\usepackage[T1]{fontenc}
\usepackage{polski}[babel]

% Layout & graphics
\usepackage[a4paper, total={7.5in, 9in}]{geometry}
\usepackage{graphicx}
\usepackage{wrapfig}              % images
\usepackage[dvipsnames,table]{xcolor} % single xcolor invocation (keeps table option)

% Math & symbols
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{gensymb}

% Typography & layout helpers
\usepackage{microtype}
\usepackage{float}                 % [H] placement
\usepackage{caption}
\usepackage{subcaption}            % modern subfigure support (do NOT load subfig)
\usepackage{multirow}
\usepackage{titlesec}

\usepackage{lmodern}
\usepackage{microtype}
\usepackage{listings}
\usepackage{xcolor}

\lstdefinestyle{MyStyle}{
    basicstyle=\ttfamily\small, % Font family and size
    keywordstyle=\color{blue}\bfseries, % Style for keywords
    commentstyle=\color{green!60!black}\itshape, % Style for comments
    %stringstyle=\color{red}, % Style for strings
    numberstyle=\tiny\color{gray}, % Style for line numbers
    backgroundcolor=\color{gray!10}, % Background color
    frame=single, % Add a frame around the code block
    breaklines=true, % Allows long lines to wrap
    language=Java, % Default language
    numbers=left, % Line numbers on the left
    showstringspaces=false % Don't show spaces in strings
}

\lstset{style=MyStyle}

\definecolor{xppblue}{RGB}{37, 150, 190}

\title{Sprawozdanie 2 z laboratorium \par Układy sterowania optymalnego}
\author{Jan Andrzejewski 159512}
\date{}

\begin{document}

\maketitle

\tableofcontents

\newpage

\section{Ćwiczenie 10-11: Linearyzacja systemu nieliniowego}

\subsection{Opis problemu}

Rozważany jest model napędzanego wahadła będący obiektem nieliniowym. Przyjmując $x_1=\theta$ (położenie kątowe) i $x_2=\dot{\theta}$ (prędkość kątowa), równania stanu systemu przyjmują postać:

\[
\dot{x}_1=x_2
\]
\[
\dot{x}_2=\frac{1}{J}u-\frac{d}{J}x_2-\frac{mgl}{J}\sin(x_1)
\]

gdzie $J=1$ kg·m², $d = 0.5$ N·m·s/rad, $m = 9$ kg, $l = 1$ m.

\subsection{Linearyzacja wokół punktu $x_0=[0,0]$, $u=0$}

Przeprowadzono linearyzację układu wokół punktu pracy $(x_0=[0,0], u_0=0)$. Dla tego punktu pracy macierze liniowego modelu przyjmują postać:

\[
A = \begin{bmatrix}
    0 & 1\\
    -\frac{mgl}{J} & -\frac{d}{J}
\end{bmatrix}, \quad
B = \begin{bmatrix}
    0\\
    \frac{1}{J}
\end{bmatrix}
\]

Podstawiając parametry:

\[
A = \begin{bmatrix}
    0 & 1\\
    -90 & -0.5
\end{bmatrix}, \quad
B = \begin{bmatrix}
    0\\
    1
\end{bmatrix}
\]

Układ jest sterowalny, ponieważ rząd macierzy Kalmana jest równy wymiarowi systemu:
\[
\text{rank}([B, AB]) = 2
\]

Rank macierzy $A$ wynosi 2, a rank macierzy sterowalności również wynosi 2. Dodatkowo, forma zaobserwowana macierzy $A$ jest formą kanoniczną, co wskazuje na pełną sterowalność systemu.

\textbf{Porównanie odpowiedzi nieliniowej i liniowej:}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{img/lininielin5.png}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{img/lininielin45sqrt.png}
\end{figure}

Z przebiegów można wyciągnąć jednoznaczny wniosek: linearyzacja wokół punktu pracy dobrze opisuje model tylko w jego bezpośrednim otoczeniu. Dla małych zaburzeń od punktu równowagi przebieg zmiennej z modelu zlinearyzowanego pokrywa się z przebiegiem modelu nieliniowego. Jednak przy zwiększaniu odchylenia od punktu pracy dokładność linearyzacji spada. Da się zaobserwowac wyraźne odchylenia pomiedzy modelem liniowym i nieliniowym dla wejscia $45\sqrt{2}$

\subsection{Linearyzacja wokół punktu $x_0=[\pi/4,0]$, $u=45\sqrt{2}$}

Dla drugiego punktu pracy macierze liniowego modelu przyjmują postać:

\[
A = \begin{bmatrix}
    0 & 1\\
    -\frac{mgl}{J}\cos(\pi/4) & -\frac{d}{J}
\end{bmatrix}, \quad
B = \begin{bmatrix}
    0\\
    \frac{1}{J}
\end{bmatrix}
\]

Podstawiając parametry:
\[
A = \begin{bmatrix}
    0 & 1\\
    -63.64 & -0.5
\end{bmatrix}
\]

W przypadku linearyzacji wokół punkty innego niż $x_0=\begin{bmatrix} 0 & 0 \end{bmatrix}$, nalży wprowadzić nowe zmienne $\tilde{x}=x-x_0$ i $\tilde{u}=u-u_0$, ostatecznie otrzymano równania stanu w postacji:
\[
\dot{\tilde{x}}=A\tilde{x}+B\tilde{u}
\]

tutaj cos jeszcze 


\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{img/lab10_fig02.png}
    \caption{Porównanie przebiegów modelu nieliniowego i zlinearyzowanego dla wymuszeń stałych}
\end{figure}

Analogicznie do zadania 1.1, model zlinearyzowany prawidłowo opisuje zachowanie systemu w otoczeniu punktu pracy. Odchylenia rosną wraz ze wzrostem odległości od punktu równowagi.

\subsection{Linearyzacja metodą SDC}

Metoda SDC polega na dyskretyzacji systemu w każdym kroku czasowym wokół bieżącego stanu, a następnie rozwiązaniu równań dyskretnych. Parametry macierzy $A$ są aktualizowane w zależności od bieżącego stanu systemu:

\[
a_{21} = -\frac{mgl}{J} \cdot \frac{\sin(x_1)}{x_1}
\]

dla $x_1 \neq 0$, co pozwala na lepsze śledzenie nieliniowych zmian systemu w porównaniu ze statyczną linearyzacją.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\linewidth]{img/sdcinonlin.png}
    \caption{Przebieg położenia dla modelu nieliniowego i zlinearyzowanego metoda SDC}
\end{figure}

Przebieg położenia przy wytraceniu układu z równowagi warunkami początkowymi $x_0=\begin{bmatrix}
    \pi/4 & 0
\end{bmatrix}$

Metoda SDC oferuje lepszą dokładność niż klasyczna linearyzacja, ponieważ parametry modelu są adaptacyjnie aktualizowane na podstawie bieżącego stanu. Pozwala to na śledzenie trajektorii dala daleko od punktu linearyzacji.

\subsection{Kod}

\begin{lstlisting}
    m, l, J, g, d = 9.0, 1.0, 1.0, 10.0, 0.5
t_sim = np.arange(0, 10, 0.01)

x_0 = [np.pi/4, 0] # x1 = theta, x2 = theta_dot
results_sdc = [x_0]

curr_x = x_0

for i in range(len(t_sim) - 1):
    x1, x2 = curr_x
    
    if abs(x1) < 1e-6:
        a21 = -(m * g * l) / J
    else:
        a21 = -(m * g * l / J) * (np.sin(x1) / x1)
    
    A = [[0, 1],
         [a21, -d/J]]
    B = [[0], [1/J]]
    C = [[1, 0], [0, 1]]
    D = [[0], [0]]
    
    sys = signal.StateSpace(A, B, C, D)
    
    t_step = [0, 0.01]
    u_step = [0, 0] 
    
    _, _, x_out = signal.lsim(sys, U=u_step, T=t_step, X0=curr_x)
    
    curr_x = x_out[-1]
    results_sdc.append(curr_x)

results_sdc = np.array(results_sdc)
    
\end{lstlisting}


\section{Ćwiczenie 12: Regulator LQR dla układów nieliniowych}

\subsection*{Zadanie 2.1: Nieliniowy model wahadła i jego liniowa aproksymacja}

Rozpatrywany jest napędzany model wahadła:
\[
J\ddot{\theta} = u - d\dot{\theta} - mgl\sin(\theta)
\]

Ze zmiennymi stanu $x_1 = \theta$, $x_2 = \dot{\theta}$, równania przyjmują postać:
\[
\dot{x}_1 = x_2
\]
\[
\dot{x}_2 = \frac{1}{J}(u - dx_2 - mgl\sin(x_1))
\]

Linearyzacja wokół punktu $x_0 = [\pi, 0]$, $u_0 = 0$ daje:

\[
A = \begin{bmatrix}
    0 & 1\\
    -\frac{mgl\cos(\pi)}{J} & -\frac{d}{J}
\end{bmatrix} = \begin{bmatrix}
    0 & 1\\
    \frac{mgl}{J} & -\frac{d}{J}
\end{bmatrix}
\]

\[
B = \begin{bmatrix}
    0\\
    \frac{1}{J}
\end{bmatrix}
\]

Z podstawionymi wartościami ($m=9$, $g=9.81$, $l=1$, $J=1$, $d=0.5$):

\[
A = \begin{bmatrix}
    0 & 1\\
    88.29 & -0.5
\end{bmatrix}, \quad
B = \begin{bmatrix}
    0\\
    1
\end{bmatrix}
\]

\textbf{Dlaczego zmienne stanu dążą do nieskończoności przy pobudzeniu skokiem jednostkowym?}

Punkt równowagi $x_0 = [\pi, 0]$ odpowiada wahadłu w pozycji górnej (wywyższonej). Jest to równowaga niestabilna, ponieważ pierwszymi charakterystycznymi macierzy $A$ są liczby rzeczywiste o przeciwnych znakach (jedno dodatnie, jedno ujemne). System jest siodłem (saddle point), co oznacza, że dowolne zaburzenie spowoduje odejście od równowagi. W szczególności, przy pobudzeniu skokiem jednostkowym, zmienne stanu będą dążyć do nieskończoności z powodu niestabilności tego punktu równowagi.

\subsection*{Zadanie 2.2: Projektowanie regulatora LQR}

Zaprojektowano regulator LQR minimalizujący wskaźnik jakości:
\[
J = \int_0^\infty (x^T Q x + u^T R u) dt
\]

Z macierzami wag:
\[
Q = I_2 = \begin{bmatrix} 1 & 0 \\ 0 & 1 \end{bmatrix}, \quad R = 1
\]

Rozwiązując ARE otrzymano wzmocnienia regulatora:

\[
K=\begin{bmatrix}
    176,5 & 18,3
\end{bmatrix}
\]

Prawo sterowania uwzgledniające punkt wokół którego układ został zlinearyzowany:
\[
u = -K(x - x_0) + u_0
\]

\textbf{Porównanie odpowiedzi dla różnych warunków początkowych:}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{img/lab12_fig01.png}
    \caption{Przebiegi pierwszej zmiennej stanu dla różnych warunków początkowych z regulatorem LQR}
\end{figure}

\textbf{Komentarz na temat globalności rozwiązania:}

Otrzymane rozwiązanie \textbf{nie jest globalne}. Regulator LQR jest projektowany dla liniowego modelu systemu wokół punktu równowagi $[\pi, 0]$. Jego działanie jest gwarantowane jedynie dla małych zaburzeń wokół tego punktu. Dla większych odchyleń (np. wahadło bliskie pozycji dolnej $[0, 0]$) liniowy model nie reprezentuje już dokładnie dynamiki systemu nieliniowego, a regulator traci swoją efektywność. Ponadto, punkt równowagi $[\pi, 0]$ jest niestabilny, co dodatkowo ogranicza obszar atrakcji regulatora.

\subsection*{Zadanie 2.3: Analiza manipulatora elastycznego}

Rozpatrywany jest manipulator z elastycznym złączem opisany równaniami:
\[
J_1\ddot{\theta}_1 + mgl\sin(\theta_1) + k(\theta_1 - \theta_2) = 0
\]
\[
J_2\ddot{\theta}_2 - k(\theta_1 - \theta_2) = u
\]

gdzie $J_1 = 0.04$ kg·m², $J_2 = 0.3$ kg·m², $k = 3$ N/m, $m = 0.5$ kg, $l = 0.5$ m.

Ze zmiennymi stanu $x = [\theta_1, \dot{\theta}_1, \theta_2, \dot{\theta}_2]^T$ równania stanu przyjmują postać:
\[
\dot{x}_1 = x_2
\]
\[
\dot{x}_2 = \frac{1}{J_1}(-mgl\sin(x_1) - k(x_1 - x_3))
\]
\[
\dot{x}_3 = x_4
\]
\[
\dot{x}_4 = \frac{1}{J_2}(u + k(x_1 - x_3))
\]

\textbf{Wpływ parametrów LQR na regulację:}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\linewidth]{img/lab12_fig02.png}
    \caption{Porównanie przebiegów dla różnych macierzy Q regulatora LQR}
\end{figure}

\textbf{Wyniki analizy:}

\begin{enumerate}
    \item Dla $Q = I_4$: Regulator wyważa zarówno położenia jak i prędkości
    \item Dla $Q = \text{diag}([10, 1, 10, 1])$: Silna penalizacja położeń, regulacja skupiona na stabilizacji pozycji
    \item Dla $Q = \text{diag}([1, 10, 1, 10])$: Silna penalizacja prędkości, regulacja skupiona na tłumieniu oscylacji
\end{enumerate}

Wyniki pokazują, że dobór macierzy $Q$ znacząco wpływa na charakterystykę regulatora. Zwiększenie wag dla położeń prowadzi do szybszej redukcji błędu położenia, ale może powodować większe oscylacje. Z kolei zwiększenie wag dla prędkości poprawia tłumienie oscylacji kosztem wolniejszej zbieżności do stanu ustalonego.

\textbf{Wnioski:}

Praktyczne zastosowanie regulatorów LQR dla systemów nieliniowych wymaga ostrożności i weryfikacji w rzeczywistych warunkach. Liniowa teoria zapewnia gwarancje jedynie w małym otoczeniu punktu linearyzacji. Dla większych zaburzeń wymagane są bardziej zaawansowane metody, takie jak:
\begin{itemize}
    \item Adaptacyjne regulatory LQR z aktualizacją macierzy $A$ i $B$
    \item Globalne regulatory z wykorzystaniem funkcji Lapunowa
    \item Hybrydowe strategie sterowania łączące liniowe i nieliniowe podejścia
\end{itemize}


\end{document}